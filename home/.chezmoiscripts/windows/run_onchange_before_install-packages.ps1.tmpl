#!/usr/bin/env pwsh

# Development Tools Installation for Windows
# PowerShell script to install development tools via curl and package managers

{{ if .dev_computer -}}
Write-Host "[Windows] Installing development tools..." -ForegroundColor Green

function Test-Command($cmdname) {
    return [bool](Get-Command -Name $cmdname -ErrorAction SilentlyContinue)
}

# Mise (modern runtime version manager)
if (-not (Test-Command mise)) {
    Write-Host "[Install] Installing Mise..." -ForegroundColor Blue
    try {
        irm https://mise.run | iex
        Write-Host "[OK] Mise installed successfully" -ForegroundColor Green
    } catch {
        Write-Host "[WARN] Mise installation failed: $($_.Exception.Message)" -ForegroundColor Yellow
    }
} else {
    Write-Host "[OK] Mise already installed" -ForegroundColor Green
}

# Install development tools via mise (including atuin)
if (Test-Command mise) {
    Write-Host "[Install] Installing development tools via mise..." -ForegroundColor Blue
    try {
        mise install
        Write-Host "[OK] Development tools installed via mise" -ForegroundColor Green
    } catch {
        Write-Host "[WARN] Some mise tools failed to install: $($_.Exception.Message)" -ForegroundColor Yellow
    }
} else {
    Write-Host "[ERROR] Mise not found - cannot install development tools" -ForegroundColor Red
}

Write-Host "[OK] Windows development tools installation completed!" -ForegroundColor Green
{{- else }}
Write-Host "[Skip] Skipping development tools installation (not a dev computer)" -ForegroundColor Yellow
{{- end }}
