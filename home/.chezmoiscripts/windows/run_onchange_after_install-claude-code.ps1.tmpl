{{- if eq .chezmoi.os "windows" -}}
#!/usr/bin/env pwsh

# Install Claude Code using the native installer (recommended approach)
# This script runs when the hash changes (onchange)

Write-Host "[Install] Installing Claude Code using native installer..." -ForegroundColor Green

# Windows PowerShell installation
Write-Host "[Install] Installing Claude Code for Windows via PowerShell..." -ForegroundColor Blue
try {
    irm https://claude.ai/install.ps1 | iex
    Write-Host "[OK] Claude Code installed successfully" -ForegroundColor Green

    # Verify installation
    if (Get-Command claude -ErrorAction SilentlyContinue) {
        $version = claude --version
        Write-Host "[OK] Claude Code version: $version" -ForegroundColor Green

        # Run claude doctor to check installation health
        Write-Host "[Check] Running installation health check..." -ForegroundColor Blue
        claude doctor
    }
} catch {
    Write-Host "[ERROR] Claude Code installation failed: $($_.Exception.Message)" -ForegroundColor Red
    exit 1
}
{{- end -}}
