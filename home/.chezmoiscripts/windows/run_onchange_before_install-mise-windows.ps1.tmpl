{{- if and .dev_computer (eq .chezmoi.os "windows") -}}
# Install mise via winget and setup shims in Windows PATH
# This script runs when its content changes

Write-Host "Installing mise via winget..."

# Install mise using winget
try {
    winget install jdx.mise
    Write-Host "mise installed successfully"
} catch {
    Write-Host "Failed to install mise via winget: $_"
    exit 1
}

# Setup shims in user PATH
$shimPath = "$env:USERPROFILE\AppData\Local\mise\shims"

# Wait a moment for installation to complete
Start-Sleep -Seconds 2

# Add shim path to user PATH if it exists
if (Test-Path $shimPath) {
    Write-Host "Setting up mise shims in Windows PATH..."
    
    # Get current user PATH
    $currentPath = [Environment]::GetEnvironmentVariable('Path', 'User')
    
    # Check if shim path is already in PATH
    $pathEntries = $currentPath -split ';'
    if ($shimPath -notin $pathEntries) {
        # Add shim path to user PATH
        $newPath = $currentPath + ";" + $shimPath
        [Environment]::SetEnvironmentVariable('Path', $newPath, 'User')
        Write-Host "Added mise shims to user PATH: $shimPath"
        Write-Host "Please restart your shell session for changes to take effect."
    } else {
        Write-Host "mise shims already in PATH"
    }
} else {
    Write-Host "Warning: mise shims directory not found after installation"
}
{{- end }}